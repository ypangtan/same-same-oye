<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Open IFéi App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
      background-color: #fafafa;
    }
    .store-links {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin: 30px 0;
      flex-wrap: wrap;
    }
    .store-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      border-radius: 12px;
      overflow: hidden;
    }
    .store-icon:hover {
      transform: scale(1.05);
    }
    .store-icon img {
      width: 150px;
      height: auto;
      display: block;
    }
    h2 {
      color: #333;
      margin-bottom: 10px;
    }
    p {
      color: #666;
      margin-bottom: 30px;
    }
    .status {
      margin-top: 20px;
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
    }
    .status.trying {
      background-color: #e3f2fd;
      color: #1976d2;
    }
    .status.success {
      background-color: #e8f5e8;
      color: #2e7d32;
    }
    .status.fallback {
      background-color: #fff3e0;
      color: #f57c00;
    }
  </style>
  <script>
    const code = new URLSearchParams(window.location.search).get('code') || '';
    
    function showStatus(message, type) {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = message;
      statusDiv.className = `status ${type}`;
      statusDiv.style.display = 'block';
    }

    function tryOpenApp(appScheme, fallbackUrl, storeName) {
      showStatus(`Trying to open ${storeName} app...`, 'trying');
      
      // Create a hidden iframe to attempt opening the app
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.src = appScheme + (code ? `?code=${code}` : '');
      document.body.appendChild(iframe);
      
      // Set a timeout to redirect to store if app doesn't open
      const startTime = Date.now();
      const timeout = setTimeout(() => {
        // If we're still on the page after 2.5 seconds, assume app didn't open
        if (Date.now() - startTime >= 2500) {
          showStatus(`App not installed. Redirecting to ${storeName}...`, 'fallback');
          window.location.href = fallbackUrl;
        }
      }, 2500);
      
      // Clean up iframe after timeout
      setTimeout(() => {
        document.body.removeChild(iframe);
      }, 3000);
      
      // Clear timeout if page becomes hidden (likely means app opened)
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          clearTimeout(timeout);
          showStatus(`Successfully opened ${storeName} app!`, 'success');
        }
      });
      
      // Alternative method for iOS using window.location
      if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
        setTimeout(() => {
          window.location.href = appScheme + (code ? `?code=${code}` : '');
        }, 100);
      }
    }

    function handleAppOpen(event, platform) {
      event.preventDefault();
      
      const schemes = {
        ios: {
          scheme: 'ifei://', // Replace with your actual iOS URL scheme
          fallback: 'https://apps.apple.com/app/id6748254600',
          name: 'iOS'
        },
        android: {
          scheme: 'intent://open#Intent;scheme=ifei;package=com.ifei.my;end', // Android intent
          fallback: 'https://play.google.com/store/apps/details?id=com.ifei.my',
          name: 'Android'
        },
        huawei: {
          scheme: 'ifei://', // Replace with your actual scheme
          fallback: 'https://appgallery.huawei.com/#/app/C114794831',
          name: 'Huawei'
        }
      };
      
      const config = schemes[platform];
      tryOpenApp(config.scheme, config.fallback, config.name);
    }

    // Auto-detect and try to open app on page load
    window.onload = function() {
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      
      if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) {
        // iOS device
        setTimeout(() => tryOpenApp('ifei://', 'https://apps.apple.com/app/id6748254600', 'iOS'), 1000);
      } else if (/android/i.test(ua)) {
        // Android device
        setTimeout(() => tryOpenApp('intent://open#Intent;scheme=ifei;package=com.ifei.my;end', 'https://play.google.com/store/apps/details?id=com.ifei.my', 'Android'), 1000);
      } else if (/Huawei/i.test(ua)) {
        // Huawei device
        setTimeout(() => tryOpenApp('ifei://', 'https://appgallery.huawei.com/#/app/C114794831', 'Huawei'), 1000);
      }
    };
  </script>
</head>
<body>
  <h2>Open IFéi</h2>
  <p>Attempting to open the app automatically...</p>
  
  <div id="status" class="status" style="display: none;"></div>
  
  <p style="margin-top: 30px; font-size: 14px; color: #888;">
    Or manually choose your app store:
  </p>
  
  <div class="store-links">
    <a class="store-icon" href="#" onclick="handleAppOpen(event, 'ios')" target="_blank">
      <img src="https://upload.wikimedia.org/wikipedia/commons/3/3c/Download_on_the_App_Store_Badge.svg" alt="Download on App Store" />
    </a>
    
    <a class="store-icon" href="#" onclick="handleAppOpen(event, 'android')" target="_blank">
      <img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg" alt="Download on Google Play" />
    </a>
    
    <a class="store-icon" href="#" onclick="handleAppOpen(event, 'huawei')" target="_blank">
      <img src="https://brandlogos.net/wp-content/uploads/2025/04/huawei_appgallery_badge-logo_brandlogos.net_0kc7c-512x155.png" alt="Download on AppGallery" />
    </a>
  </div>
  
  <p style="margin-top: 30px; font-size: 12px; color: #aaa;">
    If the app doesn't open automatically, it may not be installed on your device.
  </p>
</body>
</html>